import{r as d,j as e}from"./react-D1U-XOVe.js";import"./bootstrap-Br3a4RFp.js";import{d as D,b as v,c as C}from"./react-icons-x-3AsPeQ.js";import{H as q,a as x}from"./index-CTHL8xNu.js";import{b as A,g as E,a as L,c as O,d as z,u as V,e as k,f as H,h as M}from"./@firebase-Dtv6WlN7.js";import{a as B}from"./react-router-Djbx4wqu.js";import"./react-dom-CDA0BfTO.js";import"./scheduler-CzFDRTuY.js";import"./react-router-dom-CAxphozH.js";import"./@remix-run-DUqXQle_.js";import"./firebase-B57A6ecM.js";import"./idb-BXWtuYvb.js";import"./tslib-BGVaTf34.js";const I=A(x),T=E(x),W=L(x),oe=()=>{const w=B(),[c,P]=d.useState(!1),[u,F]=d.useState(1),[n,o]=d.useState(0),[a,f]=d.useState({nombre:"",apellidos:"",nacionalidad:"",sexo:"",nombreUsuario:"",fotoPerfil:null,email:"",password:"",repeatPassword:"",rol:"user_simple",fechaCreacion:new Date,fechaCambioRol:new Date}),[b,j]=d.useState(null),g=()=>{P(!c)},l=t=>{const{name:s,value:r}=t.target;f({...a,[s]:r})},y=t=>{const s=t.target.files[0];if(f({...a,fotoPerfil:s}),s){const r=new FileReader;r.onloadend=()=>{j(r.result)},r.readAsDataURL(s)}else j(null)},S=t=>{t.preventDefault();const{nombre:s,apellidos:r,nacionalidad:p,nombreUsuario:m,sexo:i}=a;if(!s||!r||!p||!m||!i){o(1);return}F(2),o(0)},U=async t=>{t.preventDefault();const{password:s,repeatPassword:r,fotoPerfil:p}=a;if(s.length<8){o(2);return}if(!/[A-Z]/.test(s)){o(3);return}if(s!==r){o(4);return}try{const i=(await O(I,a.email,a.password)).user;let h=null;if(p){const N=z(W,`usuarios/${i.uid}/fotoPerfil`);await V(N,p),h=await k(N)}console.log("Datos del usuario:",{...a,fotoPerfil:h});const R=H(T,"usuarios",i.uid);await M(R,{...a,rol:a.rol,fechaCreacion:a.fechaCreacion,fechaCambioRol:a.fechaCambioRol,fotoPerfil:h}),o(6),setTimeout(()=>{w("/login")},2e3)}catch(m){const i=m.code;console.error("Error al registrar el usuario:",m),o(i==="auth/email-already-in-use"?5:6)}};return e.jsxs("div",{className:"login-container",children:[e.jsx(q,{}),e.jsxs("form",{className:"form-register",onSubmit:u===1?S:U,children:[e.jsx("h2",{className:"text-center",children:u===1?"Paso 1: Información Personal":"Paso 2: Credenciales"}),n===1&&e.jsx("div",{className:"alert alert-danger",children:"Por favor, complete todos los campos obligatorios."}),n===2&&e.jsx("div",{className:"alert alert-danger",children:"La contraseña debe tener al menos 8 caracteres."}),n===3&&e.jsx("div",{className:"alert alert-danger",children:"La contraseña debe contener al menos una letra mayúscula."}),n===4&&e.jsx("div",{className:"alert alert-danger",children:"Las contraseñas no coinciden."}),n===5&&e.jsx("div",{className:"alert alert-danger",children:"No se puede crear la cuenta. ¡Correo ya utilizado!"}),n===6&&e.jsx("div",{className:"alert alert-success",children:"Usuario registrado con éxito. Redirigiendo a inicio de sesión..."}),u===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"fotoPerfil",className:"form-label",children:"Foto de Perfil (Opcional)"}),e.jsxs("div",{className:"input-group mb-2",children:[e.jsx("input",{type:"file",accept:"image/*",className:"form-control",onChange:y}),e.jsx("span",{className:"input-group-text",children:e.jsx(D,{})})]}),b&&e.jsx("div",{className:"avatar-container",children:e.jsx("img",{src:b,alt:"Avatar",className:"avatar"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"nombre",className:"form-label",children:"Nombre(s)"}),e.jsx("input",{type:"text",name:"nombre",placeholder:"Nombre",className:"form-control",value:a.nombre,onChange:l,required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"apellidos",className:"form-label",children:"Apellidos"}),e.jsx("input",{type:"text",name:"apellidos",placeholder:"Apellidos",className:"form-control",value:a.apellidos,onChange:l,required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"nombreUsuario",className:"form-label",children:"Nombre de Usuario"}),e.jsx("input",{type:"text",name:"nombreUsuario",placeholder:"Nombre de Usuario",className:"form-control",value:a.nombreUsuario,onChange:l,required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"sexo",className:"form-label",children:"Sexo"}),e.jsxs("select",{name:"sexo",className:"form-select",value:a.sexo,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Seleccione su sexo"}),e.jsx("option",{value:"Masculino",children:"Masculino"}),e.jsx("option",{value:"Femenino",children:"Femenino"}),e.jsx("option",{value:"Otro",children:"Otro"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"nacionalidad",className:"form-label",children:"País de origen"}),e.jsxs("select",{name:"nacionalidad",className:"form-select",value:a.nacionalidad,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Seleccione su nacionalidad"}),e.jsx("option",{value:"Venezolano",children:"Venezolano"}),e.jsx("option",{value:"Colombiano",children:"Colombiano"}),e.jsx("option",{value:"Peruano",children:"Peruano"}),e.jsx("option",{value:"Otro",children:"Otro"})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Siguiente"})]}),u===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Correo Electrónico"}),e.jsx("input",{type:"email",name:"email",placeholder:"Correo Electrónico",className:"form-control",value:a.email,onChange:l,required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:"Contraseña"}),e.jsxs("div",{className:"input-group mb-2",children:[e.jsx("input",{type:c?"text":"password",name:"password",placeholder:"Contraseña",className:"form-control",value:a.password,onChange:l,required:!0}),e.jsx("span",{className:"input-group-text",onClick:g,children:c?e.jsx(v,{}):e.jsx(C,{})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"repeatPassword",className:"form-label",children:"Repetir Contraseña"}),e.jsxs("div",{className:"input-group mb-2",children:[e.jsx("input",{type:c?"text":"password",name:"repeatPassword",placeholder:"Repetir Contraseña",className:"form-control",value:a.repeatPassword,onChange:l,required:!0}),e.jsx("span",{className:"input-group-text",onClick:g,children:c?e.jsx(v,{}):e.jsx(C,{})})]})]}),e.jsx("button",{type:"submit",className:"btn btn-success",children:"Registrar"})]})]})]})};export{oe as default};
